language: r
#r:
#  - oldrel
#  - release
#  - devel
  
jobs:
  include:
    - stage: api_catalogue_tests
      r: release
      install: 
       - R -e 'install.packages("devtools")'
       - R -e 'devtools::install_deps(dep = T)'
      script: 
       - R CMD build .      
       - bash tests_bash/pxweb.sh 
       - . PXWEB_ERROR.sh
       - cat PXWEB_ERROR.sh
       - echo $PXWEB_ERROR
       - exit $PXWEB_ERROR
      if: branch = test
    - stage: release
      r: release
      env:
        - CURRENT_STAGE=release  
      after_success: Rscript -e 'covr::coveralls()'
    - stage: oldrel
      r: oldrel
      if: branch = master OR branch = test
      env:
        - CURRENT_STAGE=oldrel
    - stage: devel
      r: devel
      if: branch = master OR branch = test
      env:
        - CURRENT_STAGE=devel

sudo: required

# Be strict when checking our package
warnings_are_errors: true

r_github_packages:
  -  jimhester/covr

notifications:
  email:
    on_success: change
    on_failure: change
